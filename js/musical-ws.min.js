(function(K){"object"===typeof exports&&"undefined"!==typeof module?module.exports=K():"function"===typeof define&&define.amd?define([],K):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).musical=K()})(function(){return function w(p,m,h){function x(f,d){if(!m[f]){if(!p[f]){var c="function"==typeof require&&require;if(!d&&c)return c(f,!0);if(E)return E(f,!0);c=Error("Cannot find module '"+f+"'");throw c.code="MODULE_NOT_FOUND",c;}c=m[f]={exports:{}};
p[f][0].call(c.exports,function(d){var c=p[f][1][d];return x(c?c:d)},c,c.exports,w,p,m,h)}return m[f].exports}for(var E="function"==typeof require&&require,f=0;f<h.length;f++)x(h[f]);return x}({1:[function(w,p,m){m=w("./instrument");w=w("./parser-abc");window.Instrument=m;window.parseABCFile=w;p.exports={Instrument:m,parseABCFile:w}},{"./instrument":2,"./parser-abc":3}],2:[function(w,p,m){function h(a){this._atop=x();this._timbre=E(a,this._atop);this._queue=[];this._minQueueTime=Infinity;this._maxScheduledTime=
0;this._unsortedQueue=!1;this._startSet=[];this._finishSet={};this._cleanupSet=[];this._callbackSet=[];this._handlers={};this._now=null;f()&&this.silence()}m=w("./utils");var x=m.getAudioTop,E=m.makeTimbre,f=m.isAudioPresent,H=m.defaultTimbre,d=m.pitchToMidi,c=m.midiToFrequency,z=m.audioCurrentStartTime,t=m.makeOscillator,J=m.midiToPitch,A=w("./parser-abc");h.timeOffset=.0625;h.dequeueTime=.5;h.bufferSecs=2;h.toneLength=1;h.cleanupDelay=.1;h.prototype.setTimbre=function(a){this._timbre=E(a,this._atop)};
h.prototype.getTimbre=function(a){return E(this._timbre,this._atop)};h.prototype.setVolume=function(a){this._out&&!isNaN(a)&&(this._out.gain.value=a)};h.prototype.getVolume=function(a){return this._out?this._out.gain.value:0};h.prototype.silence=function(){var a,l,b,e=1;this._queue.length=0;this._minQueueTime=Infinity;this._maxScheduledTime=0;this._startSet.length=0;l=this._finishSet;this._finishSet={};b=this._callbackSet;this._callbackSet=[];this._out&&(this._out.disconnect(),e=this._out.gain.value);
this._atop=x();this._out=this._atop.ac.createGain();this._out.gain.value=e;this._out.connect(this._atop.out);for(a in l)this._trigger("noteoff",l[a]);for(a=0;a<b.length;++a)b[a].callback()};h.prototype.now=function(){if(null!=this._now)return this._now;this._startPollTimer(!0);return this._now};h.prototype.on=function(a,l){this._handlers.hasOwnProperty(a)||(this._handlers[a]=[]);this._handlers[a].push(l)};h.prototype.off=function(a,l){if(this._handlers.hasOwnProperty(a))if(l){var b,e=this._handlers[a];
for(b=0;b<e.length;++b)e[b]===l&&(e.splice(b,1),--b)}else this._handlers[a]=[]};h.prototype._trigger=function(a,l){var b=this._handlers[a],e;if(b)if(1==b.length)b[0](l);else for(b=b.slice(),e=0;e<b.length;++e)b[e](l)};h.prototype._makeSound=function(a){var l=a.timbre||this._timbre,b=a.time+h.timeOffset,e=b+a.duration,k=Math.min(e,b+l.attack),d=l.decay*Math.pow(440/a.frequency,l.decayfollow),c=k,y=e+l.release,f=l.detune&&1!=l.detune,n=l.gain*a.velocity*(f?.5:1),g=this._atop.ac,B,F;if(0<a.duration&&
0<a.velocity){B=g.createGain();B.gain.setValueAtTime(0,b);for(B.gain.linearRampToValueAtTime(n,k);c<k+.03125&&c+1/256<e;)c+=1/256,B.gain.linearRampToValueAtTime(n*(l.sustain+(1-l.sustain)*Math.exp((k-c)/d)),c);B.gain.setTargetAtTime(n*l.sustain,c,d);B.gain.setValueAtTime(n*(l.sustain+(1-l.sustain)*Math.exp((k-e)/d)),e);B.gain.linearRampToValueAtTime(0,y);B.connect(this._out);!l.cutoff&&!l.cutfollow||Infinity==l.cutoff?e=B:(e=g.createBiquadFilter(),e.frequency.value=l.cutoff+a.frequency*l.cutfollow,
e.Q.value=l.resonance,e.connect(B));k=t(this._atop,l.wave,a.frequency);k.connect(e);k.start(b);k.stop(y);f&&(F=t(this._atop,l.wave,a.frequency*l.detune),F.connect(e),F.start(b),F.stop(y));a.gainNode=B;a.oscillators=[k];f&&a.oscillators.push(F);a.cleanuptime=y}else a.duration=0;this._startSet.push(a)};h.prototype._truncateSound=function(a,l){if(l<a.time+a.duration&&(a.duration=Math.max(0,l-a.time),a.gainNode)){var b=a.timbre||this._timbre,e=a.time+h.timeOffset,k=l+h.timeOffset,d=Math.min(k,e+b.attack),
c=b.decay*Math.pow(440/a.frequency,b.decayfollow),f=k+b.release,t=f+h.cleanupDelay,n=b.gain*a.velocity*(b.detune&&1!=b.detune?.5:1),g=a.gainNode;g.gain.cancelScheduledValues(k);k<=e?g.gain.setValueAtTime(0,k):k<=d?g.gain.linearRampToValueAtTime(n*(k-e)/(d-e)):g.gain.setValueAtTime(n*(b.sustain+(1-b.sustain)*Math.exp((d-k)/c)),k);g.gain.linearRampToValueAtTime(0,f);if(a.oscillators)for(b=0;b<a.oscillators.length;++b)a.oscillators[b].stop(f);a.cleanuptime=t}};h.prototype._doPoll=function(){this._now=
this._pollTimer=null;if(window.interrupted)this.silence();else{var a=this._atop.ac.currentTime+5E-4,l=[],b,e,k,d;if(this._minQueueTime-a<=h.bufferSecs){this._unsortedQueue&&(this._queue.sort(function(a,e){return a.time!=e.time?a.time-e.time:a.duration!=e.duration?a.duration-e.duration:a.frequency-e.frequency}),this._unsortedQueue=!1);for(b=0;b<this._queue.length&&!(this._queue[b].time-a>h.bufferSecs);++b);if(0<b){e=this._queue.splice(0,b);for(b=0;b<e.length;++b)this._makeSound(e[b]);this._minQueueTime=
0<this._queue.length?this._queue[0].time:Infinity}}for(b=0;b<this._cleanupSet.length;++b)d=this._cleanupSet[b],d.cleanuptime<a&&(d.gainNode&&(d.gainNode.disconnect(),d.gainNode=null),this._cleanupSet.splice(b,1),--b);for(k in this._finishSet)d=this._finishSet[k],e=d.time+d.duration,e<=a&&(l.push({order:[e,0],f:this._trigger,t:this,a:["noteoff",d]}),Infinity!=d.cleanuptime&&this._cleanupSet.push(d),delete this._finishSet[k]);for(b=0;b<this._callbackSet.length;++b)k=this._callbackSet[b],e=k.time,e<=
a&&(l.push({order:[e,1],f:k.callback,t:null,a:[]}),this._callbackSet.splice(b,1),--b);for(b=0;b<this._startSet.length;++b)this._startSet[b].time<=a&&(d=this._startSet[b],k=d.frequency,e=null,this._finishSet.hasOwnProperty(k)&&(e=this._finishSet[k],e.time<d.time||e.time==d.time&&e.duration<d.duration?(this._truncateSound(e,d.time),l.push({order:[d.time,0],f:this._trigger,t:this,a:["noteoff",e]}),delete this._finishSet[k]):(this._truncateSound(d,e.time),e=d)),this._startSet.splice(b,1),--b,0<d.duration&&
0<d.velocity&&e!==d&&(this._finishSet[k]=d,l.push({order:[d.time,2],f:this._trigger,t:this,a:["noteon",d]})));this._startPollTimer();l.sort(function(a,e){return a.order[0]!=e.order[0]?a.order[0]-e.order[0]:a.order[1]-e.order[1]});for(b=0;b<l.length;++b)k=l[b],k.f.apply(k.t,k.a)}};h.prototype._startPollTimer=function(a){if(!this._pollTimer||null==this._now){var d=this,b=function(){d._doPoll()},e=Infinity;this._pollTimer&&(clearTimeout(this._pollTimer),this._pollTimer=null);if(a)this._now=z(),this._pollTimer=
setTimeout(b,0);else{for(a=0;a<this._startSet.length;++a)e=Math.min(e,this._startSet[a].time);for(a in this._finishSet)e=Math.min(e,this._finishSet[a].time+this._finishSet[a].duration);for(a=0;a<this._callbackSet.length;++a)e=Math.min(e,this._callbackSet[a].time);0<this._cleanupSet.length&&(e=Math.min(e,this._cleanupSet[0].cleanuptime+1));e=Math.min(e,this._minQueueTime-h.dequeueTime);e=Math.max(.001,e-this._atop.ac.currentTime);isNaN(e)||Infinity==e||(this._pollTimer=setTimeout(b,Math.round(1E3*
e)))}}};h.prototype.tone=function(a,l,b,e,k,f){if(this._atop){"object"==typeof a&&(null==b&&(b=a.velocity),null==l&&(l=a.duration),null==e&&(e=a.delay),null==k&&(k=a.timbre),null==f&&(f=a.origin),a=a.pitch);var t;a||(a="C");isNaN(a)?(a=d(a),t=c(a)):(t=Number(a),0>t?(a=-t,t=c(a)):a=frequencyToMidi(t));k||(k=this._timbre);if(k!==this._timbre){var y=k,v;k={};for(v in H)k[v]=v in y?y[v]:defaulTimbre[v]}v=this.now();e=v+(e||0);l={time:e,on:!1,frequency:t,midi:a,velocity:null==b?1:b,duration:null==l?h.toneLength:
l,timbre:k,instrument:this,gainNode:null,oscillators:null,cleanuptime:Infinity,origin:f};e<v+h.bufferSecs?this._makeSound(l):(!this._unsortedQueue&&this._queue.length&&e<this._queue[this._queue.length-1].time&&(this._unsortedQueue=!0),this._queue.push(l),this._minQueueTime=Math.min(this._minQueueTime,l.time))}};h.prototype.schedule=function(a,d){this._callbackSet.push({time:this.now()+a,callback:d})};h.prototype.play=function(a){var d=Array.prototype.slice.call(arguments),b=null,e={},k,c,f,h,t=0,
n,g,B,F,G,C,q,u,p,r=[];d.length&&"function"==typeof d[d.length-1]&&(b=d.pop());if(this._atop){f=0;if("object"==typeof d[0]){for(h in d[0])d[0].hasOwnProperty(h)&&(e[h]=d[0][h]);f=1;e.song&&d.push(e.song)}for(;f<d.length;++f)for(k=d[f].split(/\n(?=X:)/),h=0;h<k.length;++h)if(c=A(k[h]))!e.tempo&&c.tempo&&(e.tempo=c.tempo,c.unitbeat&&(e.tempo*=c.unitbeat/(c.unitnote||1))),c.voice&&r.push(c);e.tempo||(e.tempo=120);null==e.volume&&(e.volume=1);q=60/e.tempo;for(h=0;h<r.length;++h)for(B in c=r[h],c.voice)if(d=
E(e.timbre||c.voice[B].timbre||c.timbre||this._timbre,this._atop),n=c.voice[B].stems){for(g=k=0;g<n.length;++g){G=n[g];f=1/Math.sqrt(G.notes.length);for(F=0;F<G.notes.length;++F)C=G.notes[F],C.holdover||(u=(C.time||G.time)*q,G.staccato?u=Math.min(Math.min(u,q/16),d.attack+d.decay):!C.slurred&&.125<=u&&(u-=.03125),p=(C.velocity||1)*f*e.volume,this.tone(C.pitch,u,p,k,d,C));k+=G.time*q}t=Math.max(k,t)}this._maxScheduledTime=Math.max(this._maxScheduledTime,this.now()+t);b&&this.schedule(t,b)}else b&&
b()};h.pitchToMidi=function(a){return"string"==typeof a?d(a):a};h.midiToPitch=function(a){return"number"==typeof a?J(a):a};p.exports=h},{"./parser-abc":3,"./utils":4}],3:[function(w,p,m){var h=w("./utils").pitchToFrequency,x=/^([A-Za-z]):\s*(.*)$/,E=/(?:\[[A-Za-z]:[^\]]*\])|\s+|%[^\n]*|![^\s!:|\[\]]*!|\+[^+|!]*\+|[_<>@^]?"[^"]*"|\[|\]|>+|<+|(?:(?:\^+|_+|=|)[A-Ga-g](?:,+|'+|))|\(\d+(?::\d+){0,2}|\d*\/\d+|\d+\/?|\/+|[xzXZ]|\[?\|\]?|:?\|:?|::|./g;p.exports=function(f){function p(a,b){switch(a){case "V":k!==
e&&d(b.split(" ")[0]);break;case "M":var g=k,c=/^C/.test(b)?1:l(b);c&&!g.unitnote&&(g.unitnote=.75>c?.0625:.125);break;case "L":g=k;if(c=l(b))g.unitnote=c;break;case "Q":var g=k,c=b.split(/\s+|=/),n,f=null,h=null;for(n=0;n<c.length;++n)0<=c[n].indexOf("/")||/^[1-4]$/.test(c[n])?f=f||l(c[n]):h=h||Number(c[n]);f&&(g.unitbeat=f);h&&(g.tempo=h)}k.hasOwnProperty(a)?k[a]+="\n"+b:k[a]=b;if("K"==a){if(b){g=b.replace(/\s+/g,"").toLowerCase().substr(0,5);c=(c=g.match(/maj|min|mix|dor|phr|lyd|loc|m/))?"maj"==
c?g.substr(0,c.index):"min"==c?g.substr(0,c.index+1):g.substr(0,c.index+c[0].length):/^[a-g][#b]?/.exec(g)||"";n={"c#":7,"f#":6,b:5,e:4,a:3,d:2,g:1,c:0,f:-1,bb:-2,eb:-3,ab:-4,db:-5,gb:-6,cb:-7,"a#m":7,"d#m":6,"g#m":5,"c#m":4,"f#m":3,bm:2,em:1,am:0,dm:-1,gm:-2,cm:-3,fm:-4,bbm:-5,ebm:-6,abm:-7,"g#mix":7,"c#mix":6,"f#mix":5,bmix:4,emix:3,amix:2,dmix:1,gmix:0,cmix:-1,fmix:-2,bbmix:-3,ebmix:-4,abmix:-5,dbmix:-6,gbmix:-7,"d#dor":7,"g#dor":6,"c#dor":5,"f#dor":4,bdor:3,edor:2,ador:1,ddor:0,gdor:-1,cdor:-2,
fdor:-3,bbdor:-4,ebdor:-5,abdor:-6,dbdor:-7,"e#phr":7,"a#phr":6,"d#phr":5,"g#phr":4,"c#phr":3,"f#phr":2,bphr:1,ephr:0,aphr:-1,dphr:-2,gphr:-3,cphr:-4,fphr:-5,bbphr:-6,ebphr:-7,"f#lyd":7,blyd:6,elyd:5,alyd:4,dlyd:3,glyd:2,clyd:1,flyd:0,bblyd:-1,eblyd:-2,ablyd:-3,dblyd:-4,gblyd:-5,cblyd:-6,fblyd:-7,"b#loc":7,"e#loc":6,"a#loc":5,"d#loc":4,"g#loc":3,"c#loc":2,"f#loc":1,bloc:0,eloc:-1,aloc:-2,dloc:-3,gloc:-4,cloc:-5,floc:-6,bbloc:-7}[c];g={};if(n)if(0<n)for(f=0;f<n&&7>f;++f)g["FCGDAEB".charAt(f)]="^";
else for(f=0;f>n&&-7<f;--f)g["FCGDAEB".charAt(6+f)]="_";if(c=b.substr(c.length).match(/(_+|=|\^+)[a-g]/ig))for(n=0;n<c.length;++n)f=c[n].charAt(c[n].length-1).toUpperCase(),"="==c[n].charAt(0)?delete g[f]:g[f]=c[n].substr(0,c[n].length-1);w=g}else w={};k===e&&d(e.V?e.V.split(/\s+/)[0]:"")}}function d(a){if((a=a||"")||k===e)e.voice||(e.voice={}),e.voice.hasOwnProperty(a)?k=e.voice[a]:(k={id:a,accent:{slurred:0}},e.voice[a]=k),y=k.accent}function c(b){b=b.match(E);var g,c=0,f=0,n=null,C;if(!b)return null;
for(;c<b.length;)if(/^[\s%]/.test(b[c]))c++;else if(/^\[[A-Za-z]:[^\]]*\]$/.test(b[c]))p(b[c].substring(1,2),b[c].substring(3,b[c].length-1).trim()),c++;else if(/</.test(b[c]))f=-b[c++].length;else if(/>/.test(b[c]))f=b[c++].length;else if(/^\(\d+(?::\d+)*/.test(b[c]))n=b[c++],(n=/^\((\d+)(?::(\d+)(?::(\d+))?)?$/.exec(n))?(g=Number(n[1]),n={time:(Number(n[2])||2)/g,count:Number(n[3])||g}):n=null;else if(/^[!+].*[!+]$/.test(b[c])){g=b[c++];var q=y;if(!(2>g.length))switch(g=g.substring(1,g.length-1),
g){case "pppp":case "ppp":q.dynamics=.2;break;case "pp":q.dynamics=.4;break;case "p":q.dynamics=.6;break;case "mp":q.dynamics=.8;break;case "mf":q.dynamics=1;break;case "f":q.dynamics=1.2;break;case "ff":q.dynamics=1.4;break;case "fff":case "ffff":q.dynamics=1.5}}else if("{"==b[c])for(;c<b.length&&"}"!=b[c++];);else if(/^.?".*"$/.test(b[c]))c++;else if(/^[()]$/.test(b[c]))"("==b[c++]?y.slurred+=1:(--y.slurred,0>=y.slurred&&(y.slurred=0,k.stems&&1<=k.stems.length&&J(k.stems[k.stems.length-1],!1)));
else if(/\|/.test(b[c])){for(C in y)1==C.length&&delete y[C];c++}else{a:{var u,m,r=b;g=c;var v=w,A=y,q=[],z="",x=!1,D,H=Infinity;g<r.length&&"."==r[g]&&(x=!0,g++);if(g<r.length&&"["==r[g]){for(g++;g<r.length;)if(/^[\s%]/.test(r[g]))g++;else{if(/[A-Ga-g]/.test(r[g]))D={pitch:a(r[g++],v,A),tie:!1},D.frequency=h(D.pitch),q.push(D);else if(/[xzXZ]/.test(r[g]))D=null,g++;else if("."==r[g]){x=!0;g++;continue}else break;g<r.length&&/^(?![\s%!]).*[\d\/]/.test(r[g])?(u=r[g++],m=l(u)):(u="",m=1);D&&(D.duration=
u,D.time=m);m&&m<H&&(z=u,H=m);g<r.length&&"-"==r[g]&&(D&&(q[q.length-1].tie=!0),g++)}if("]"!=r[g]){g=null;break a}g++}else if(g<r.length&&/[A-Ga-g]/.test(r[g]))D={pitch:a(r[g++],v,A),tie:!1,duration:"",time:1},D.frequency=h(D.pitch),q.push(D);else if(g<r.length&&/^[xzXZ]$/.test(r[g]))g++;else{g=null;break a}if(g<r.length&&/^(?![\s%!]).*[\d\/]/.test(r[g]))for(z=r[g++],m=l(z),u=0;u<q.length;++u)q[u].duration=z,q[u].time=m;if(g<r.length&&"-"==r[g])for(g++,u=0;u<q.length;++u)q[u].tie=!0;if(A.dynamics)for(m=
A.dynamics,u=0;u<q.length;++u)q[u].velocity=m;g={index:g,stem:{notes:q,duration:z,staccato:x,time:l(z)}}}if(null===g)c++;else{if(n){q=g.stem;z=n.time;q.time*=z;for(c=0;c<q.notes.length;++c)q.notes[c].time*=z;--n.count;n.count||(n=null)}f&&k.stems&&k.stems.length&&(C=0<f?(1-Math.pow(.5,f))*g.stem.time:(Math.pow(.5,-f)-1)*k.stems[k.stems.length-1].time,t(k.stems[k.stems.length-1],C),t(g.stem,-C));f=0;y.slurred&&J(g.stem,!0);k===e&&d(e.V?e.V.split(/\s+/)[0]:"");"stems"in k||(k.stems=[]);k.stems.push(g.stem);
c=g.index}}}function m(a){var b={},c,d,e,k,f;for(d=0;d<a.length;++d){c={};for(e=0;e<a[d].notes.length;++e)f=k=a[d].notes[e],b.hasOwnProperty(k.pitch)&&(f=b[k.pitch],f.time+=k.time,k.holdover=!0),k.tie&&(c[k.pitch]=f);b=c}}function t(a,b){var c,d,e=a.time,g=e+b;a.time=g;for(c=0;c<a.notes.length;++c)d=a.notes[c],d.time==e&&(d.time=g)}function J(a,b){var c,d;for(c=0;c<a.notes.length;++c)d=a.notes[c],b?d.slurred=!0:d.slurred&&delete d.slurred}function A(a){return 0<a.length&&"="==a.charAt(0)?a.substr(1):
a}function a(a,c,b){var d=/^(\^+|_+|=|)([A-Ga-g])(.*)$/.exec(a),e;if(!d)return a;e=d[2].toUpperCase();return 0<d[1].length?(b[e]=d[1],A(a)):b.hasOwnProperty(e)?A(b[e]+d[2]+d[3]):c.hasOwnProperty(e)?A(c[e]+d[2]+d[3]):A(a)}function l(a){var b=/^(\d*)(?:\/(\d*))?$|^(\/+)$/.exec(a),c,d=0,e;if(b){if(b[3])return Math.pow(.5,b[3].length);c=b[2]?parseFloat(b[2]):/\//.test(a)?2:1;e=0;a=b[1]?parseFloat(b[1]):1;if(b[2])for(;e+1<b[1].length&&a>c;)e+=1,d=parseFloat(b[1].substring(0,e)),a=parseFloat(b[1].substring(e));
return d+a/c}}var b=f.split("\n"),e={},k=e,v,w={},y={slurred:0};for(f=0;f<b.length;++f)(v=x.exec(b[f]))?p(v[1],v[2].trim()):/^\s*(?:%.*)?$/.test(b[f])||c(b[f]);for(f=0;f<b.length;++f)(v=x.exec(b[f]))?p(v[1],v[2].trim()):/^\s*(?:%.*)?$/.test(b[f]);var I=["unitnote","unitbeat","tempo"];if(e.voice){v=[];for(f in e.voice)if(e.voice[f].stems&&e.voice[f].stems.length){m(e.voice[f].stems);for(b=0;b<I.length;++b)!(I[b]in e)&&I[b]in e.voice[f]&&(e[I[b]]=e.voice[f][I[b]]);delete e.voice[f].accent}else v.push(f);
for(f=0;f<v.length;++f)delete e.voice[v[f]]}return e}},{"./utils":4}],4:[function(w,p,m){(function(h){var m=w("./wavetable-builder");p.exports.isAudioPresent=isAudioPresent=function(){return!(!h.AudioContext&&!h.webkitAudioContext)};p.exports.getAudioTop=getAudioTop=function(){if(getAudioTop.audioTop)return getAudioTop.audioTop;if(!isAudioPresent())return null;var d=new (h.AudioContext||h.webkitAudioContext);getAudioTop.audioTop={ac:d,wavetable:m(d),out:null,currentStart:null};if(getAudioTop.audioTop){d=
getAudioTop.audioTop;d.out&&(d.out.disconnect(),d.out=null,d.currentStart=null);var c=d.ac.createDynamicsCompressor();c.ratio=16;c.attack=5E-4;c.connect(d.ac.destination);d.out=c}return getAudioTop.audioTop};p.exports.audioCurrentStartTime=audioCurrentStartTime=function(){var d=getAudioTop();if(null!=d.currentStart)return d.currentStart;d.currentStart=Math.max(.25,d.ac.currentTime);setTimeout(function(){d.currentStart=null},0);return d.currentStart};p.exports.midiToFrequency=midiToFrequency=function(d){return 440*
Math.pow(2,(d-69)/12)};var E={C:0,D:2,E:4,F:5,G:7,A:9,B:11,c:12,d:14,e:16,f:17,g:19,a:21,b:23},f={"^":1,"":0,"=":0,_:-1},H="C ^C D _E E F ^F G _A A _B B c ^c d _e e f ^f g _a a _b b".split(" ");p.exports.pitchToMidi=pitchToMidi=function(d){d=/^(\^+|_+|=|)([A-Ga-g])([,']*)$/.exec(d);if(!d)return null;var c=d[3].replace(/,/g,"").length-d[3].replace(/'/g,"").length;return E[d[2]]+f[d[1].charAt(0)]*d[1].length+12*c+60};p.exports.midiToPitch=function(d){var c=(d-72)%12;if(60<d||0!=c)c+=12;d=Math.round((d-
c-60)/12);for(c=H[c];0!=d;)c+=0<d?"'":",",d+=0<d?-1:1;return c};p.exports.pitchToFrequency=pitchToFrequency=function(d){return midiToFrequency(pitchToMidi(d))};p.exports.defaultTimbre=defaultTimbre={wave:"square",gain:.1,attack:.002,decay:.4,decayfollow:0,sustain:0,release:.1,cutoff:0,cutfollow:0,resonance:0,detune:0};p.exports.makeTimbre=function(d,c){d||(d={});"string"==typeof d&&(d={wave:d});var f={},h,m=c&&c.wavetable&&c.wavetable[d.wave];for(h in defaultTimbre)d.hasOwnProperty(h)?f[h]=d[h]:m&&
m.defs&&m.defs.hasOwnProperty(h)?f[h]=m.defs[h]:f[h]=defaultTimbre[h];return f};p.exports.makeOscillator=makeOscillator=function(d,c,f){if("noise"==c){c=d.ac.createBufferSource();if(null==h){h=getAudioTop().ac;f=2*h.sampleRate;for(var h=h.createBuffer(1,f,h.sampleRate),m=h.getChannelData(0),p=0;p<f;p++)m[p]=2*Math.random()-1}c.buffer=h;c.loop=!0;return c}h=d.wavetable;d=d.ac.createOscillator();var a,l;try{if(h.hasOwnProperty(c)){p=h[c].wave;if(h[c].freq)for(m in a=0,h[c].freq)l=Number(m),f>l&&l>a&&
(a=l,p=h[c].freq[a]);!d.setPeriodicWave&&d.setWaveTable?d.setWaveTable(p):d.setPeriodicWave(p)}else d.type=c}catch(b){window.console&&window.console.log(b),d.type="square"}d.frequency.value=f;return d}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./wavetable-builder":5}],5:[function(w,p,m){p.exports=function(h){return function(m){function p(a){var c=a.real.length,b=new Float32Array(c),d=new Float32Array(c),f;for(f=0;f<c;++f)b[f]=
a.real[f],d[f]=a.imag[f];try{return h.createPeriodicWave(b,d)}catch(v){}try{return h.createWaveTable(b,d)}catch(v){}return null}function f(a,c,b){var d={real:[],imag:[]},f,h=a.real.length,l;for(f=0;f<h;++f)l=Math.log(c[Math.min(f,c.length-1)]),d.real.push(a.real[f]*Math.exp(b*l)),d.imag.push(a.imag[f]*Math.exp(b*l));return d}var w={},d,c,z,t,x,A;for(d in m)if(c=m[d],A=p(c)){x={wave:A};if(c.mult)for(t=m[d].freq,x.freq={},z=0;z<t.length;++z)(A=p(f(c,c.mult,(z+1)/t.length)))&&(x.freq[t[z]]=A);c.defs&&
(x.defs=c.defs);w[d]=x}return w}({string:{real:[0,-0,-.179748,.252497,-.212162,.069443,-.067304,.006291,-.063344,.007604,-.069661,.004429,-.01903,6.01E-4,-.001895,8.41E-4,-.009026,.001311,-.024059,.002217,-.019063,.002118,-.04849,6.59E-4,-.007014,5.29E-4,-.003632,1.57E-4,-2.65E-4,4.6E-5,-3.25E-4,5.03E-4],imag:[0,.20893,-1E-6,4E-6,-5E-6,3E-6,-4E-6,0,-6E-6,1E-6,-1E-5,1E-6,-4E-6,0,-1E-6,0,-3E-6,1E-6,-1.2E-5,1E-6,-1.1E-5,1E-6,-3.5E-5,1E-6,-6E-6,0,-4E-6,0,0,0,0,1E-6],mult:[.1,.1,.18,.016,.01,.01,.01,.004,
.014,.02,.014,.004,.002,.01],freq:[35,60,100,135,180,240,420,800],defs:{wave:"string",gain:.6,attack:.001,decay:.15,sustain:.001,release:.1,decayfollow:.005,cutoff:2500,cutfollow:.1,resonance:.4,detune:.9994}}})}},{}]},{},[1])(1)});
